/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

draw2d.Drag=function(){};draw2d.Drag.current=null;draw2d.Drag.currentTarget=null;draw2d.Drag.currentHover=null;draw2d.Drag.currentCompartment=null;draw2d.Drag.dragging=false;draw2d.Drag.isDragging=function(){return this.dragging;};draw2d.Drag.setCurrent=function(_11ca){this.current=_11ca;this.dragging=true;};draw2d.Drag.getCurrent=function(){return this.current;};draw2d.Drag.clearCurrent=function(){this.current=null;this.dragging=false;this.currentTarget=null;};draw2d.Draggable=function(_11cb,_11cc){this.id=draw2d.UUID.create();this.node=null;draw2d.EventTarget.call(this);this.construct(_11cb,_11cc);this.diffX=0;this.diffY=0;this.targets=new draw2d.ArrayList();};draw2d.Draggable.prototype=new draw2d.EventTarget();draw2d.Draggable.prototype.construct=function(_11cd){if(_11cd===null||_11cd===undefined){return;}this.element=_11cd;var oThis=this;var _11cf=function(){var _11d0=new draw2d.DragDropEvent();_11d0.initDragDropEvent("dblclick",true);oThis.dispatchEvent(_11d0);var _11d1=arguments[0]||window.event;_11d1.cancelBubble=true;_11d1.returnValue=false;};var _11d2=function(){var _11d3=arguments[0]||window.event;var _11d4=new draw2d.DragDropEvent();if(oThis.node!==null){var _11d5=oThis.node.getWorkflow().getAbsoluteX();var _11d6=oThis.node.getWorkflow().getAbsoluteY();var _11d7=oThis.node.getWorkflow().getScrollLeft();var _11d8=oThis.node.getWorkflow().getScrollTop();_11d4.x=_11d3.clientX-oThis.element.offsetLeft+_11d7-_11d5;_11d4.y=_11d3.clientY-oThis.element.offsetTop+_11d8-_11d6;}if(_11d3.button===2){_11d4.initDragDropEvent("contextmenu",true);oThis.dispatchEvent(_11d4);}else{_11d4.initDragDropEvent("dragstart",true);if(oThis.dispatchEvent(_11d4)){oThis.diffX=_11d3.clientX-oThis.element.offsetLeft;oThis.diffY=_11d3.clientY-oThis.element.offsetTop;draw2d.Drag.setCurrent(oThis);if(oThis.isAttached==true){oThis.detachEventHandlers();}oThis.attachEventHandlers();}}_11d3.cancelBubble=true;_11d3.returnValue=false;};var _11d9=function(){if(draw2d.Drag.getCurrent()===null){var _11da=arguments[0]||window.event;if(draw2d.Drag.currentHover!==null&&oThis!==draw2d.Drag.currentHover){var _11db=new draw2d.DragDropEvent();_11db.initDragDropEvent("mouseleave",false,oThis);draw2d.Drag.currentHover.dispatchEvent(_11db);}if(oThis!==null&&oThis!==draw2d.Drag.currentHover){var _11db=new draw2d.DragDropEvent();_11db.initDragDropEvent("mouseenter",false,oThis);oThis.dispatchEvent(_11db);}draw2d.Drag.currentHover=oThis;}else{}};if(this.element.addEventListener){this.element.addEventListener("mousemove",_11d9,false);this.element.addEventListener("mousedown",_11d2,false);this.element.addEventListener("dblclick",_11cf,false);}else{if(this.element.attachEvent){this.element.attachEvent("onmousemove",_11d9);this.element.attachEvent("onmousedown",_11d2);this.element.attachEvent("ondblclick",_11cf);}else{throw "Drag not supported in this browser.";}}};draw2d.Draggable.prototype.onDrop=function(_11dc,_11dd){};draw2d.Draggable.prototype.attachEventHandlers=function(){var oThis=this;oThis.isAttached=true;this.tempMouseMove=function(){var _11df=arguments[0]||window.event;var _11e0=new draw2d.Point(_11df.clientX-oThis.diffX,_11df.clientY-oThis.diffY);if(oThis.node!==null&&oThis.node.getCanSnapToHelper()){_11e0=oThis.node.getWorkflow().snapToHelper(oThis.node,_11e0);}oThis.element.style.left=_11e0.x+"px";oThis.element.style.top=_11e0.y+"px";if(oThis.node!==null){var _11e1=oThis.node.getWorkflow().getScrollLeft();var _11e2=oThis.node.getWorkflow().getScrollTop();var _11e3=oThis.node.getWorkflow().getAbsoluteX();var _11e4=oThis.node.getWorkflow().getAbsoluteY();var _11e5=oThis.getDropTarget(_11df.clientX+_11e1-_11e3,_11df.clientY+_11e2-_11e4);var _11e6=oThis.getCompartment(_11df.clientX+_11e1-_11e3,_11df.clientY+_11e2-_11e4);if(draw2d.Drag.currentTarget!==null&&_11e5!=draw2d.Drag.currentTarget){var _11e7=new draw2d.DragDropEvent();_11e7.initDragDropEvent("dragleave",false,oThis);draw2d.Drag.currentTarget.dispatchEvent(_11e7);}if(_11e5!==null&&_11e5!==draw2d.Drag.currentTarget){var _11e7=new draw2d.DragDropEvent();_11e7.initDragDropEvent("dragenter",false,oThis);_11e5.dispatchEvent(_11e7);}draw2d.Drag.currentTarget=_11e5;if(draw2d.Drag.currentCompartment!==null&&_11e6!==draw2d.Drag.currentCompartment){var _11e7=new draw2d.DragDropEvent();_11e7.initDragDropEvent("figureleave",false,oThis);draw2d.Drag.currentCompartment.dispatchEvent(_11e7);}if(_11e6!==null&&_11e6.node!=oThis.node&&_11e6!==draw2d.Drag.currentCompartment){var _11e7=new draw2d.DragDropEvent();_11e7.initDragDropEvent("figureenter",false,oThis);_11e6.dispatchEvent(_11e7);}draw2d.Drag.currentCompartment=_11e6;}var _11e8=new draw2d.DragDropEvent();_11e8.initDragDropEvent("drag",false);oThis.dispatchEvent(_11e8);};oThis.tempMouseUp=function(){oThis.detachEventHandlers();var _11e9=arguments[0]||window.event;if(oThis.node!==null){var _11ea=oThis.node.getWorkflow().getScrollLeft();var _11eb=oThis.node.getWorkflow().getScrollTop();var _11ec=oThis.node.getWorkflow().getAbsoluteX();var _11ed=oThis.node.getWorkflow().getAbsoluteY();var _11ee=oThis.getDropTarget(_11e9.clientX+_11ea-_11ec,_11e9.clientY+_11eb-_11ed);var _11ef=oThis.getCompartment(_11e9.clientX+_11ea-_11ec,_11e9.clientY+_11eb-_11ed);if(_11ee!==null){var _11f0=new draw2d.DragDropEvent();_11f0.initDragDropEvent("drop",false,oThis);_11ee.dispatchEvent(_11f0);}if(_11ef!==null&&_11ef.node!==oThis.node){var _11f0=new draw2d.DragDropEvent();_11f0.initDragDropEvent("figuredrop",false,oThis);_11ef.dispatchEvent(_11f0);}if(draw2d.Drag.currentTarget!==null){var _11f0=new draw2d.DragDropEvent();_11f0.initDragDropEvent("dragleave",false,oThis);draw2d.Drag.currentTarget.dispatchEvent(_11f0);draw2d.Drag.currentTarget=null;}}var _11f1=new draw2d.DragDropEvent();_11f1.initDragDropEvent("dragend",false);oThis.dispatchEvent(_11f1);oThis.onDrop(_11e9.clientX,_11e9.clientY);draw2d.Drag.currentCompartment=null;draw2d.Drag.clearCurrent();};if(document.body.addEventListener){document.body.addEventListener("mousemove",this.tempMouseMove,false);document.body.addEventListener("mouseup",this.tempMouseUp,false);}else{if(document.body.attachEvent){document.body.attachEvent("onmousemove",this.tempMouseMove);document.body.attachEvent("onmouseup",this.tempMouseUp);}else{throw new Error("Drag doesn't support this browser.");}}};draw2d.Draggable.prototype.detachEventHandlers=function(){this.isAttached=false;if(document.body.removeEventListener){document.body.removeEventListener("mousemove",this.tempMouseMove,false);document.body.removeEventListener("mouseup",this.tempMouseUp,false);}else{if(document.body.detachEvent){document.body.detachEvent("onmousemove",this.tempMouseMove);document.body.detachEvent("onmouseup",this.tempMouseUp);}else{throw new Error("Drag doesn't support this browser.");}}};draw2d.Draggable.prototype.getDropTarget=function(x,y){for(var i=0;i<this.targets.getSize();i++){var _11f5=this.targets.get(i);if(_11f5.node.isOver(x,y)&&_11f5.node!==this.node){return _11f5;}}return null;};draw2d.Draggable.prototype.getCompartment=function(x,y){var _11f8=null;for(var i=0;i<this.node.getWorkflow().compartments.getSize();i++){var _11fa=this.node.getWorkflow().compartments.get(i);if(_11fa.isOver(x,y)&&_11fa!==this.node){if(_11f8===null){_11f8=_11fa;}else{if(_11f8.getZOrder()<_11fa.getZOrder()){_11f8=_11fa;}}}}return _11f8===null?null:_11f8.dropable;};draw2d.Draggable.prototype.getLeft=function(){return this.element.offsetLeft;};draw2d.Draggable.prototype.getTop=function(){return this.element.offsetTop;};draw2d.DragDropEvent=function(){draw2d.AbstractEvent.call(this);};draw2d.DragDropEvent.prototype=new draw2d.AbstractEvent();draw2d.DragDropEvent.prototype.initDragDropEvent=function(sType,_11fc,_11fd){this.initEvent(sType,_11fc);this.relatedTarget=_11fd;};draw2d.DropTarget=function(_11fe){draw2d.EventTarget.call(this);this.construct(_11fe);};draw2d.DropTarget.prototype=new draw2d.EventTarget();draw2d.DropTarget.prototype.construct=function(_11ff){this.element=_11ff;};draw2d.DropTarget.prototype.getLeft=function(){var el=this.element;var ol=el.offsetLeft;while((el=el.offsetParent)!==null){ol+=el.offsetLeft;}return ol;};draw2d.DropTarget.prototype.getTop=function(){var el=this.element;var ot=el.offsetTop;while((el=el.offsetParent)!==null){ot+=el.offsetTop;}return ot;};draw2d.DropTarget.prototype.getHeight=function(){return this.element.offsetHeight;};draw2d.DropTarget.prototype.getWidth=function(){return this.element.offsetWidth;};